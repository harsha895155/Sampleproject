<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports & Analytics | FintechPro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/components.css">
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Outfit', sans-serif; margin: 0; background: #0F172A; color: white; }
        
        .sidebar {
            width: 260px;
            background: rgba(255,255,255,0.02);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255,255,255,0.08);
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 2rem 1.25rem;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
        }

        .nav-item {
            width: 100%;
            height: 54px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            padding: 0 1.25rem;
            margin-bottom: 0.75rem;
            color: #94A3B8;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 600;
            gap: 1rem;
        }

        .nav-item:hover, .nav-item.active {
            background: linear-gradient(135deg, #6366F1, #8B5CF6);
            color: white;
            transform: translateX(5px);
        }

        .content {
            margin-left: 260px;
            padding: 4rem;
            min-height: 100vh;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(20px, 1fr));
            gap: 1rem;
            margin-bottom: 3rem;
        }

        .summary-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 16px;
            padding: 1rem;
            transition: all 0.3s ease;
            width: 220px;
            height: 100px;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.04);
        }

        .filter-panel {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem; 
        }

        .filter-group label {
            display: block;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6366F1;
            margin-bottom: 0.75rem;
        }

        .filter-input {
            width: 100%;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 0.875rem 1rem;
            color: white;
            font-family: inherit;
            font-size: 0.9rem;
            box-sizing: border-box;
        }

        .filter-input:focus {
            outline: none;
            border-color: #6366F1;
            background: rgba(255,255,255,0.05);
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 1.2fr 1.8fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .chart-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 16px;
            padding: 2rem;
        }

        .report-table-container {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 16px;
            overflow: hidden;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
        }

        .report-table thead {
            background: rgba(99, 102, 241, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .report-table th {
            padding: 1.25rem 1.5rem;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6366F1;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            cursor: pointer;
        }

        .report-table th:hover {
            background: rgba(99, 102, 241, 0.15);
        }

        .report-table td {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.04);
            font-size: 0.9rem;
        }

        .report-table tbody tr:hover {
            background: rgba(255,255,255,0.03);
        }

        .status-badge {
            padding: 0.375rem 0.875rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
        }

        .status-approved { background: rgba(16, 185, 129, 0.15); color: #10B981; }
        .status-pending { background: rgba(251, 191, 36, 0.15); color: #FBB924; }
        .status-rejected { background: rgba(244, 63, 94, 0.15); color: #F43F5E; }

        .export-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            background: rgba(255,255,255,0.02);
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }

        .btn-export {
            padding: 0.625rem 1.5rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 8px;
            color: white;
            font-family: inherit;
            font-weight: 700;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-export:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: #6366F1;
        }

        .highlight-high {
            background: rgba(244, 63, 94, 0.08) !important;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 2rem;
        }

        .page-btn {
            width: 38px;
            height: 38px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .page-btn:hover, .page-btn.active {
            background: #6366F1;
            border-color: #6366F1;
        }

        select.filter-input option {
            background: #1e293b;
            color: white;
            padding: 0.75rem;
        }
    </style>
</head>
<body class="creative-mode">
    <div class="sidebar">
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 4rem; padding-left: 0.5rem;">
            <div style="width: 42px; height: 42px; background: linear-gradient(135deg, #6366F1, #D946EF); border-radius: 12px; transform: rotate(45deg); display: flex; align-items: center; justify-content: center;">
                <span style="transform: rotate(-45deg); color: white; font-weight: 900; font-size: 1.2rem;">F</span>
            </div>
            <span style="font-weight: 900; font-size: 1.5rem; letter-spacing: -0.04em;">FINTECH<span style="color: #6366F1;">PRO</span></span>
        </div>
        
        <a href="/views/dashboard.html" class="nav-item">
            <span style="font-size: 1.25rem;">üè†</span>
            <span>Dashboard</span>
        </a>
        <a href="/views/expenses.html" class="nav-item">
            <span style="font-size: 1.25rem;">üí∏</span>
            <span>Expenses</span>
        </a>
        <a href="/views/transactions.html" class="nav-item">
            <span style="font-size: 1.25rem;">üìã</span>
            <span>Transactions</span>
        </a>
        <a href="/views/reports.html" class="nav-item active">
            <span style="font-size: 1.25rem;">üìä</span>
            <span>Reports</span>
        </a>
        <a href="/views/admin.html" id="adminNavItem" class="nav-item">
            <span style="font-size: 1.25rem;">üë§</span>
            <span>Admin</span>
        </a>
        <a href="/views/profile.html" class="nav-item">
            <span style="font-size: 1.25rem;">üë§</span>
            <span>Profile</span>
        </a>
        <a href="/views/settings.html" class="nav-item">
            <span style="font-size: 1.25rem;">‚öôÔ∏è</span>
            <span>Settings</span>
        </a>
        <a href="/views/support.html" class="nav-item">
            <span style="font-size: 1.25rem;">üéß</span>
            <span>Support</span>
        </a>
        
        <div style="flex: 1;"></div>
        
        <a href="/index.html" class="nav-item" style="margin-bottom: 0;">
            <span style="font-size: 1.25rem;">üö™</span>
            <span>Logout</span>
        </a>
    </div>

    <main class="content">
        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4rem;">
            <div>
                <h1 style="font-size: 2.5rem; font-weight: 800; margin: 0;">Financial <span style="background: linear-gradient(to right, #6366F1, #D946EF); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Reports</span></h1>
                <p style="color: #94A3B8; margin-top: 0.5rem;">Comprehensive analytics and insights on your financial data.</p>
            </div>
            <div style="display: flex; align-items: center; gap: 1.5rem;">
                <div id="headerAvatar" style="width: 50px; height: 50px; background: linear-gradient(135deg, #6366F1, #D946EF); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; font-weight: 800; color: white; background-size: cover; background-position: center; border: 1px solid rgba(255,255,255,0.08);">U</div>
            </div>
        </header>

        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="width: 48px; height: 48px; background: rgba(244, 63, 94, 0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üí∏</div>
                    <div style="flex: 1;">
                        <p style="font-size: 0.75rem; color: #64748B; margin: 0; font-weight: 700;">TOTAL EXPENSES</p>
                        <h3 id="totalExpenses" style="font-size: 1.75rem; font-weight: 800; margin: 0.25rem 0 0 0;">‚Çπ0</h3>
                    </div>
                </div>
            </div>
            
            <div class="summary-card">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="width: 48px; height: 48px; background: rgba(16, 185, 129, 0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üí∞</div>
                    <div style="flex: 1;">
                        <p style="font-size: 0.75rem; color: #64748B; margin: 0; font-weight: 700;">TOTAL INCOME</p>
                        <h3 id="totalIncome" style="font-size: 1.75rem; font-weight: 800; margin: 0.25rem 0 0 0;">‚Çπ4,52,200</h3>
                    </div>
                </div>
            </div>
            
            <div class="summary-card">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="width: 48px; height: 48px; background: rgba(99, 102, 241, 0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üìä</div>
                    <div style="flex: 1;">
                        <p style="font-size: 0.75rem; color: #64748B; margin: 0; font-weight: 700;">NET BALANCE</p>
                        <h3 id="netBalance" style="font-size: 1.75rem; font-weight: 800; margin: 0.25rem 0 0 0; color: #10B981;">‚Çπ4,52,200</h3>
                    </div>
                </div>
            </div>
            
            <div class="summary-card">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="width: 48px; height: 48px; background: rgba(217, 70, 239, 0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üèÜ</div>
                    <div style="flex: 1;">
                        <p style="font-size: 0.75rem; color: #64748B; margin: 0; font-weight: 700;">TOP CATEGORY</p>
                        <h3 id="topCategory" style="font-size: 1.2rem; font-weight: 800; margin: 0.25rem 0 0 0;">Technology</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Panel -->
        <div class="filter-panel" style="position: relative; overflow: hidden; border: 1px solid rgba(99, 102, 241, 0.2); background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));">
            <div style="position: absolute; top: -50px; right: -50px; width: 151px; height: 150px; background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%); pointer-events: none;"></div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <span style="font-size: 1.5rem;">üìã</span>
                    <h3 style="font-size: 1.25rem; font-weight: 800; margin: 0;">Filters & Controls</h3>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <select id="reportYear" class="filter-input" style="width: auto; padding: 0.5rem 1rem; border-radius: 8px; background: rgba(99, 102, 241, 0.1); color: #818CF8;" onchange="applyFilters()">
                        <option value="2026">2026</option>
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                    </select>
                    <button onclick="resetFilters()" style="padding: 0.5rem 1.25rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); border-radius: 8px; color: white; font-weight: 700; font-size: 0.8rem; cursor: pointer; transition: all 0.3s ease;">
                        üîÑ Reset All
                    </button>
                </div>
            </div>
            
            <div class="filter-grid" style="grid-template-columns: repeat(4, 1fr);">
                <div class="filter-group">
                    <label>Report Type</label>
                    <select id="reportType" class="filter-input">
                        <option>Monthly Report</option>
                        <option>Daily Report</option>
                        <option>Weekly Report</option>
                        <option>Yearly Report</option>
                        <option>Custom Date Range</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Date From</label>
                    <input type="date" id="dateFrom" class="filter-input">
                </div>
                
                <div class="filter-group">
                    <label>Date To</label>
                    <input type="date" id="dateTo" class="filter-input">
                </div>
                
                <div class="filter-group">
                    <label>Category</label>
                    <select id="filterCategory" class="filter-input">
                        <option value="">All Categories</option>
                        <option>Technology</option>
                        <option>Travel</option>
                        <option>Food & Dining</option>
                        <option>Healthcare</option>
                        <option>Education</option>
                        <option>Entertainment</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Payment Mode</label>
                    <select id="filterPayment" class="filter-input">
                        <option value="">All Modes</option>
                        <option>UPI</option>
                        <option>Credit Card</option>
                        <option>Bank Transfer</option>
                        <option>Cash</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Status</label>
                    <select id="filterStatus" class="filter-input">
                        <option value="">All Status</option>
                        <option>Approved</option>
                        <option>Pending</option>
                        <option>Rejected</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Min Amount (‚Çπ)</label>
                    <input type="number" id="minAmount" class="filter-input" placeholder="Min">
                </div>
                
                <div class="filter-group">
                    <label>Max Amount (‚Çπ)</label>
                    <input type="number" id="maxAmount" class="filter-input" placeholder="Max">
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button onclick="applyFilters()" class="btn-creative btn-primary-creative" style="flex: 2; padding: 1rem; font-size: 0.9rem; font-weight: 800;">üöÄ Apply & Synchronize Analytics</button>
                <button onclick="window.print()" class="btn-creative" style="flex: 1; padding: 1rem; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1);">üñ®Ô∏è Quick Print</button>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="chart-grid">
            <div class="chart-card">
                <h3 style="font-size: 1.1rem; font-weight: 800; margin: 0 0 2rem 0;">Category Breakdown</h3>
                <canvas id="categoryChart"></canvas>
            </div>
            
            <div class="chart-card">
                <h3 style="font-size: 1.1rem; font-weight: 800; margin: 0 0 2rem 0;">Monthly Trend</h3>
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <!-- Report Table -->
        <div class="report-table-container">
            <div class="export-bar">
                <h3 style="font-size: 1.1rem; font-weight: 800; margin: 0;">Detailed Transaction Report</h3>
                <div style="display: flex; gap: 1rem;">
                    <button class="btn-export" onclick="exportPDF()">üìÑ PDF</button>
                    <button class="btn-export" onclick="exportExcel()">üìä Excel</button>
                    <button class="btn-export" onclick="exportCSV()">üìã CSV</button>
                    <button class="btn-export" onclick="window.print()">üñ®Ô∏è Print</button>
                </div>
            </div>
            
            <table class="report-table">
                <thead>
                    <tr>
                        <th onclick="sortTable('date')">Date ‚ñº</th>
                        <th onclick="sortTable('description')">Description</th>
                        <th onclick="sortTable('category')">Category</th>
                        <th onclick="sortTable('payment')">Payment Mode</th>
                        <th onclick="sortTable('amount')">Amount</th>
                        <th onclick="sortTable('user')">User</th>
                        <th onclick="sortTable('status')">Status</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody">
                    <!-- Dynamically populated -->
                </tbody>
            </table>
            
            <div class="pagination" id="pagination">
                <!-- Dynamic pagination -->
            </div>
        </div>
    </main>

    <script>
        let allTransactions = [];
        let filteredTransactions = [];
        let currentPage = 1;
        const rowsPerPage = 10;
        let sortColumn = 'date';
        let sortDirection = 'desc';

        // Initialize
        window.addEventListener('load', () => {
            const loggedInUser = JSON.parse(localStorage.getItem('fintech_logged_in_user')) || { name: 'User', role: 'Individual' };

            // Avatar Logic
            const avatar = document.getElementById('headerAvatar');
            const savedPhoto = localStorage.getItem('fintech_profile_pic');
            const userInitial = (loggedInUser && loggedInUser.name ? loggedInUser.name.charAt(0) : 'U').toUpperCase();

            if (savedPhoto && savedPhoto.startsWith('data:image')) {
                avatar.style.backgroundImage = `url(${savedPhoto})`;
                avatar.textContent = '';
            } else {
                avatar.textContent = userInitial;
            }
            
            // RBAC: Show Admin only for administrators
            const userRole = (loggedInUser && loggedInUser.role) ? loggedInUser.role.toLowerCase() : '';
            const adminLink = document.getElementById('adminNavItem');
            if (adminLink) {
                if (userRole === 'administrator') {
                    adminLink.style.display = 'flex';
                } else {
                    adminLink.style.display = 'none';
                }
            }

            // Load Data
            loadTransactionData();
            renderCharts();
            applyFilters();
        });

        function loadTransactionData() {
            const expenses = JSON.parse(localStorage.getItem('fintech_expenses')) || [];
            
            // Generate sample transaction data from expenses
            allTransactions = expenses.map((exp, idx) => ({
                date: exp.date || new Date().toISOString().split('T')[0],
                description: exp.merchant || `Transaction ${idx + 1}`,
                category: exp.category || 'Technology',
                payment: exp.payment || 'UPI',
                amount: exp.amount || 0,
                user: 'Harsha V',
                status: ['Approved', 'Pending', 'Approved'][idx % 3]
            }));

            // If no expenses, add sample data
            if (allTransactions.length === 0) {
                allTransactions = [
                    { date: '2024-02-01', description: 'Office Laptop', category: 'Technology', payment: 'Credit Card', amount: 85000, user: 'Harsha V', status: 'Approved' },
                    { date: '2024-02-05', description: 'Team Lunch', category: 'Food & Dining', payment: 'UPI', amount: 2500, user: 'Harsha V', status: 'Approved' },
                    { date: '2024-02-08', description: 'Flight Tickets', category: 'Travel', payment: 'Bank Transfer', amount: 15000, user: 'Alex Rivera', status: 'Pending' },
                ];
            }

            updateSummary();
        }

        function updateSummary() {
            const totalExp = filteredTransactions.reduce((sum, t) => sum + t.amount, 0);
            const balance = parseFloat(localStorage.getItem('fintech_balance')) || 452200;
            
            document.getElementById('totalExpenses').textContent = '‚Çπ' + totalExp.toLocaleString('en-IN');
            document.getElementById('totalIncome').textContent = '‚Çπ' + balance.toLocaleString('en-IN');
            document.getElementById('netBalance').textContent = '‚Çπ' + (balance - totalExp).toLocaleString('en-IN');
            
            // Find top category
            const categoryTotals = {};
            filteredTransactions.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });
            const topCat = Object.keys(categoryTotals).sort((a, b) => categoryTotals[b] - categoryTotals[a])[0];
            document.getElementById('topCategory').textContent = topCat || 'Technology';
        }

        function applyFilters() {
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const category = document.getElementById('filterCategory').value;
            const payment = document.getElementById('filterPayment').value;
            const status = document.getElementById('filterStatus').value;
            const minAmt = parseFloat(document.getElementById('minAmount').value) || 0;
            const maxAmt = parseFloat(document.getElementById('maxAmount').value) || Infinity;

            filteredTransactions = allTransactions.filter(t => {
                if (category && t.category !== category) return false;
                if (payment && t.payment !== payment) return false;
                if (status && t.status !== status) return false;
                if (t.amount < minAmt || t.amount > maxAmt) return false;
                if (dateFrom && t.date < dateFrom) return false;
                if (dateTo && t.date > dateTo) return false;
                return true;
            });

            updateSummary();
            renderTable(currentPage);
            renderCharts();
        }

        function resetFilters() {
            document.getElementById('reportType').value = 'Monthly Report';
            document.getElementById('reportYear').value = new Date().getFullYear();
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterPayment').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('minAmount').value = '';
            document.getElementById('maxAmount').value = '';
            applyFilters();
        }

        function renderTable(page) {
            const tbody = document.getElementById('reportTableBody');
            tbody.innerHTML = '';

            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const pageData = filteredTransactions.slice(start, end);

            pageData.forEach(t => {
                const statusClass = `status-${t.status.toLowerCase()}`;
                const isHighAmount = t.amount > 50000;
                const row = `
                    <tr class="${isHighAmount ? 'highlight-high' : ''}">
                        <td>${t.date}</td>
                        <td style="font-weight: 600;">${t.description}</td>
                        <td>${t.category}</td>
                        <td>${t.payment}</td>
                        <td style="font-weight: 800; color: ${isHighAmount ? '#F43F5E' : 'white'};">‚Çπ${t.amount.toLocaleString('en-IN')}</td>
                        <td>${t.user}</td>
                        <td><span class="status-badge ${statusClass}">${t.status}</span></td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredTransactions.length / rowsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.textContent = i;
                btn.onclick = () => {
                    currentPage = i;
                    renderTable(i);
                };
                pagination.appendChild(btn);
            }
        }

        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'desc';
            }

            filteredTransactions.sort((a, b) => {
                const valA = a[column];
                const valB = b[column];
                if (typeof valA === 'number') {
                    return sortDirection === 'asc' ? valA - valB : valB - valA;
                }
                return sortDirection === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
            });

            renderTable(currentPage);
        }

        let categoryChart, trendChart;
        const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

        function renderCharts() {
            // Category Pie Chart
            const categoryData = {};
            filteredTransactions.forEach(t => {
                categoryData[t.category] = (categoryData[t.category] || 0) + Number(t.amount);
            });

            const chartColors = ['#6366F1', '#8B5CF6', '#D946EF', '#EC4899', '#F43F5E', '#FB923C', '#FBBF24', '#22C55E', '#06B6D4'];

            if (categoryChart) categoryChart.destroy();
            const ctxPie = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(ctxPie, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{
                        data: Object.values(categoryData),
                        backgroundColor: chartColors,
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#94A3B8', font: { family: 'Outfit', weight: 600 }, padding: 20 } }
                    }
                }
            });

            // Monthly Trend Chart (12 Months)
            const yearData = new Array(12).fill(0);
            const currentYear = new Date().getFullYear();
            
            filteredTransactions.forEach(t => {
                const d = new Date(t.date);
                if (d.getFullYear() === currentYear) {
                    yearData[d.getMonth()] += Number(t.amount);
                }
            });

            if (trendChart) trendChart.destroy();
            const ctxLine = document.getElementById('trendChart').getContext('2d');
            
            // Create Gradient
            const gradient = ctxLine.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(99, 102, 241, 0.3)');
            gradient.addColorStop(1, 'rgba(99, 102, 241, 0)');

            trendChart = new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: monthNames,
                    datasets: [{
                        label: 'Total Expenses',
                        data: yearData,
                        borderColor: '#6366F1',
                        borderWidth: 3,
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#6366F1',
                        pointBorderColor: 'rgba(255,255,255,0.2)',
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            ticks: { color: '#64748B', font: { family: 'Outfit' } },
                            grid: { color: 'rgba(255,255,255,0.05)' } 
                        },
                        x: { 
                            ticks: { color: '#64748B', font: { family: 'Outfit' } },
                            grid: { display: false } 
                        }
                    }
                }
            });
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(18);
            doc.text('FintechPro - Financial Report', 14, 22);
            doc.setFontSize(11);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 14, 30);
            
            let yPos = 40;
            filteredTransactions.forEach((t, idx) => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                doc.text(`${t.date} | ${t.description} | ‚Çπ${t.amount.toLocaleString('en-IN')} | ${t.status}`, 14, yPos);
                yPos += 7;
            });
            
            doc.save('fintech-report.pdf');
            alert('PDF downloaded successfully! üìÑ');
        }

        function exportExcel() {
            // Prepare data for Excel
            const excelData = [
                ['FintechPro - Financial Report'],
                [`Generated: ${new Date().toLocaleString()}`],
                [], // Empty row
                ['Date', 'Description', 'Category', 'Payment Mode', 'Amount (‚Çπ)', 'User', 'Status']
            ];

            // Add transaction data
            filteredTransactions.forEach(t => {
                excelData.push([
                    t.date,
                    t.description,
                    t.category,
                    t.payment,
                    t.amount,
                    t.user,
                    t.status
                ]);
            });

            // Add summary at the bottom
            excelData.push([]);
            excelData.push(['Summary']);
            excelData.push(['Total Expenses', '', '', '', filteredTransactions.reduce((sum, t) => sum + t.amount, 0)]);
            excelData.push(['Total Transactions', filteredTransactions.length]);

            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(excelData);

            // Set column widths
            ws['!cols'] = [
                { wch: 12 },  // Date
                { wch: 30 },  // Description
                { wch: 18 },  // Category
                { wch: 15 },  // Payment Mode
                { wch: 15 },  // Amount
                { wch: 20 },  // User
                { wch: 12 }   // Status
            ];

            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Financial Report');

            // Generate Excel file and trigger download
            const fileName = `FintechPro_Report_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert('Excel report downloaded successfully! üìä');
        }

        function exportCSV() {
            let csv = 'Date,Description,Category,Payment Mode,Amount,User,Status\n';
            filteredTransactions.forEach(t => {
                csv += `${t.date},${t.description},${t.category},${t.payment},${t.amount},${t.user},${t.status}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'fintech-report.csv';
            a.click();
            alert('CSV downloaded successfully! üìã');
        }
    </script>
</body>
</html>
